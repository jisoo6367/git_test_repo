<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring5.mypro00.mapper.MyReplyMapper">

<!-- 특정 게시물에 대한 댓글 목록 조회: 페이징 고려 -->
	<select id="selectMyReplyList"
			resultType="com.spring5.mypro00.domain.MyReplyVO"
			parameterType="com.spring5.mypro00.common.paging.domain.MyReplyPagingDTO">
	<![CDATA[
		SELECT lvl, rno, rcontent, rwriter, rRegDate, rModDate, bno, prno
		FROM (SELECT /*+ INDEX(tbl_myreply IDX_BNO_RNO_REPLY) */ ROWNUM rn, LEVEL lvl, a.*
		     FROM book_ex.tbl_myreply a
		     WHERE bno = #{bno}
		     AND ROWNUM <= ( #{pageNum} * #{rowAmountPerPage} )
		     START WITH prno IS NULL
		     CONNECT BY PRIOR rno = prno
		     )
		where rn >= (#{pageNum} * #{rowAmountPerPage}) - ( #{rowAmountPerPage} -1)
	]]>
	</select>
	
	
	
<!-- 특정 게시물에 대한 댓글 총 개수 -->
	<select id="selectRowTotal" resultType="Long" parameterType="long">
			select count(*) from book_ex.tbl_myreply
			where bno = ${bno}
	
	</select>



<!-- 특정 게시물에 대한 댓글 등록 -->
	<insert id="insertMyReplyForBoard" parameterType="com.spring5.mypro00.domain.MyReplyVO">
			<selectKey keyProperty="rno" order="BEFORE">
				SELECT book_ex.seq_myreply.NEXTVAL FROM dual
			</selectKey>
			
		
		INSERT INTO book_ex.tbl_myreply
		VALUES (#{rno}, #{rcontent},#{rwriter}, DEFAULT, DEFAULT, #{bno}, null, default)
	</insert>



<!-- 댓글에 대한 답글 등록 -->
	<insert id="insertMyReplyForReply" parameterType="com.spring5.mypro00.domain.MyReplyVO">
			<selectKey keyProperty="rno" order="BEFORE">
				SELECT book_ex.seq_myreply.NEXTVAL FROM dual
			</selectKey>
			
		
		INSERT INTO book_ex.tbl_myreply
		VALUES (#{rno}, #{rcontent},#{rwriter}, DEFAULT, DEFAULT, #{bno}, #{prno}, default)
	</insert>
	
	
<!-- 특정 게시물에 대한 특정 댓글/답글 조회 -->	
	
	
	
	
	
	
	
	
	
</mapper>